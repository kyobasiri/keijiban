<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:MessageManager.ViewModels"
        xmlns:i="using:Avalonia.Xaml.Interactivity"
        xmlns:behaviors="using:Avalonia.Xaml.Interactions.Core"
        xmlns:core="using:Avalonia.Xaml.Interactions.Core"
        xmlns:localBehaviors="using:MessageManager.Behaviors"
        xmlns:converters="clr-namespace:MessageManager.Converters"
        x:Class="MessageManager.Views.EmergencyNoticeWindow"
        x:DataType="vm:EmergencyNoticeViewModel"
        Title="ç·Šæ€¥é€£çµ¡äº‹é …ç®¡ç†"
        Width="1600" Height="900"
        WindowStartupLocation="CenterScreen">

  
  <Design.DataContext>
    <vm:EmergencyNoticeViewModel/>
  </Design.DataContext>

  <Window.Resources>
    <converters:PriorityToStringConverter x:Key="PriorityToStringConverter"/>
  </Window.Resources>

  <Window.Styles>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ« -->
    <Style Selector="Border.Header">
      <Setter Property="Background" Value="#4682B4"/>
      <Setter Property="Padding" Value="15,10"/>
    </Style>

    <Style Selector="TextBlock.HeaderTitle">
      <Setter Property="FontSize" Value="18"/>
      <Setter Property="FontWeight" Value="Bold"/>
      <Setter Property="Foreground" Value="White"/>
    </Style>

    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <Style Selector="Border.SectionHeader">
      <Setter Property="Background" Value="#E8F4FD"/>
      <Setter Property="BorderBrush" Value="#4682B4"/>
      <Setter Property="BorderThickness" Value="0,0,0,2"/>
      <Setter Property="Padding" Value="10,8"/>
    </Style>

    <!-- ãƒ•ã‚©ãƒ¼ãƒ ã‚¹ã‚¿ã‚¤ãƒ« -->
    <Style Selector="TextBox.FormInput">
      <Setter Property="Padding" Value="8"/>
      <Setter Property="Margin" Value="0,0,30,0"/>
      <Setter Property="BorderBrush" Value="#CCCCCC"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="CornerRadius" Value="4"/>
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="VerticalAlignment" Value="Center"/>
      <Setter Property="MinHeight" Value="34"/>
    </Style>

    <Style Selector="ComboBox.FormSelect">
      <Setter Property="Padding" Value="8"/>
      <Setter Property="Margin" Value="0,0,30,0"/>
      <Setter Property="BorderBrush" Value="#CCCCCC"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="CornerRadius" Value="4"/>
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="VerticalAlignment" Value="Center"/>
      <Setter Property="MinHeight" Value="34"/>
    </Style>

    <Style Selector="TextBlock.FormLabel">
      <Setter Property="FontWeight" Value="Bold"/>
      <Setter Property="Margin" Value="0,0,10,0"/>
      <Setter Property="FontSize" Value="13"/>
      <Setter Property="VerticalAlignment" Value="Center"/>
    </Style>

    <!-- ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« -->
    <Style Selector="Button.PrimaryButton">
      <Setter Property="Background" Value="#28a745"/>
      <Setter Property="Foreground" Value="White"/>
      <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="CornerRadius" Value="4"/>
      <Setter Property="Padding" Value="22,15"/>
      <Setter Property="FontWeight" Value="Bold"/>
      <Setter Property="Margin" Value="0,0,10,0"/>
      <Setter Property="MinHeight" Value="38"/>
      <Setter Property="FontSize" Value="16"/>
    </Style>

    <Style Selector="Button.PrimaryButton:disabled">
      <Setter Property="Background" Value="#6c757d"/>
    </Style>

    <Style Selector="Button.EditButton">
      <Setter Property="Background" Value="#ff6b35"/>
      <Setter Property="Foreground" Value="White"/>
      <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="CornerRadius" Value="4"/>
      <Setter Property="Padding" Value="15,10"/>
      <Setter Property="FontWeight" Value="Bold"/>
      <Setter Property="Margin" Value="0,0,10,0"/>
      <Setter Property="MinHeight" Value="38"/>
    </Style>

    <Style Selector="Button.SecondaryButton">
      <Setter Property="Background" Value="#6c757d"/>
      <Setter Property="Foreground" Value="White"/>
      <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="CornerRadius" Value="4"/>
      <Setter Property="Padding" Value="12,8"/>
      <Setter Property="Margin" Value="0,0,10,0"/>
    </Style>

    <Style Selector="Button.ActionButton">
      <Setter Property="Background" Value="#007bff"/>
      <Setter Property="Foreground" Value="White"/>
      <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="CornerRadius" Value="4"/>
      <Setter Property="Padding" Value="10,5"/>
      <Setter Property="FontSize" Value="13"/>
      <Setter Property="Margin" Value="2"/>
    </Style>

    <!-- å±¥æ­´ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ  -->
    <Style Selector="Border.HistoryListItem">
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="CornerRadius" Value="4"/>
      <Setter Property="Padding" Value="12,10"/>
      <Setter Property="Margin" Value="0,0,0,4"/>
    </Style>

    <Style Selector="Border.HistoryListItem.Active">
      <Setter Property="Background" Value="#E3F2FD"/>
      <Setter Property="BorderBrush" Value="#2196F3"/>
    </Style>

    <Style Selector="Border.HistoryListItem.Inactive">
      <Setter Property="Background" Value="#f5f5f5"/>
      <Setter Property="BorderBrush" Value="#CCCCCC"/>
    </Style>

    <Style Selector="Border.HistoryListItem.Editing">
      <Setter Property="Background" Value="#1e3a8a"/>
      <Setter Property="BorderBrush" Value="#dc3545"/>
      <Setter Property="BorderThickness" Value="2"/>
    </Style>

    <!-- ãƒãƒƒã‚¸ã‚¹ã‚¿ã‚¤ãƒ« -->
    <Style Selector="Border.StatusBadge">
      <Setter Property="CornerRadius" Value="12"/>
      <Setter Property="Padding" Value="10,5"/>
      <Setter Property="Margin" Value="0,0,8,0"/>
      <Setter Property="VerticalAlignment" Value="Center"/>
    </Style>

    <!-- è©³ç´°ãƒ‘ãƒãƒ« -->
    <Style Selector="Border.DetailPanel">
      <Setter Property="Background" Value="White"/>
      <Setter Property="BorderBrush" Value="#DDDDDD"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="CornerRadius" Value="4"/>
      <Setter Property="Padding" Value="20"/>
    </Style>

    <!-- éƒ¨ç½²ã‚¿ã‚°ã‚¹ã‚¿ã‚¤ãƒ« -->
    <Style Selector="Border.DepartmentTag">
      <Setter Property="Background" Value="#E3F2FD"/>
      <Setter Property="BorderBrush" Value="#2196F3"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="CornerRadius" Value="4"/>
      <Setter Property="Padding" Value="8,4"/>
      <Setter Property="Margin" Value="0,0,6,4"/>
    </Style>

    <!-- æœ‰åŠ¹ç„¡åŠ¹åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ -->
    <Style Selector="Button.ToggleButton">
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="BorderBrush" Value="#dee2e6"/>
      <Setter Property="Padding" Value="10,5"/>
      <Setter Property="FontSize" Value="13"/>
      <Setter Property="Margin" Value="1"/>
      <Setter Property="MinWidth" Value="50"/>
    </Style>

    <!-- ç„¡åŠ¹åŒ–ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ -->
    <Style Selector="Button.ToggleButton:disabled">
      <Setter Property="Opacity" Value="1"/>
    </Style>

      <Style Selector="Button.ClearButton">
        <Setter Property="Background" Value="#6c757d"/>
        <Setter Property="Foreground" Value="White"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="CornerRadius" Value="4"/>
        <Setter Property="Padding" Value="22,10"/>
        <Setter Property="FontWeight" Value="Bold"/>
        <Setter Property="Margin" Value="0,0,10,0"/>
        <Setter Property="MinHeight" Value="20"/>
        <Setter Property="FontSize" Value="13"/>
      </Style>
  </Window.Styles>

  <Grid RowDefinitions="Auto,Auto,*">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <Border Grid.Row="0" Classes="Header">
      <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
        <TextBlock Classes="HeaderTitle" Text="ç·Šæ€¥é€£çµ¡äº‹é …ç®¡ç†"/>
        <Button Content="Ã—é–‰ã˜ã‚‹" Background="Transparent"
                Foreground="White" BorderThickness="0"
                Margin="20,0,0,0" FontSize="14"
                Command="{Binding CloseWindowCommand}"/>
      </StackPanel>
    </Border>

    <!-- å…¥åŠ›ã‚¨ãƒªã‚¢ -->
    <Border Grid.Row="1" Classes="DetailPanel" Margin="15,15,15,10">
      <Grid RowDefinitions="Auto,Auto,Auto">
        <Border Grid.Row="0" Classes="SectionHeader">
          <StackPanel Orientation="Horizontal">
            <TextBlock Text="ç·Šæ€¥é€£çµ¡äº‹é …ç™»éŒ²" FontWeight="Bold" FontSize="16" Foreground="#4682B4"/>
          </StackPanel>
        </Border>

        <!-- 1è¡Œç›®ï¼šå…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ¨ªä¸¦ã³ -->
        <Grid Grid.Row="1"
              ColumnDefinitions="Auto,140,Auto,160,Auto,220,Auto,*,Auto"
              Margin="0,20,0,10">

          <!-- é‡è¦åº¦ -->
          <TextBlock Grid.Column="0" Classes="FormLabel" Text="é‡è¦åº¦:"/>
          <ComboBox Grid.Column="1" Classes="FormSelect"
                    ItemsSource="{Binding PriorityOptions}"
                    SelectedItem="{Binding SelectedPriority}">
            <ComboBox.ItemTemplate>
              <DataTemplate>
                <StackPanel Orientation="Horizontal">
                  <TextBlock Text="{Binding Converter={StaticResource PriorityToStringConverter}}" Margin="0,0,4,0"/>
                  <TextBlock Text="{Binding}" FontSize="10" Foreground="#666"/>
                </StackPanel>
              </DataTemplate>
            </ComboBox.ItemTemplate>
          </ComboBox>

          <!-- é€£çµ¡äº‹é …ã®ç¨®é¡ž -->
          <TextBlock Grid.Column="2" Classes="FormLabel" Text="ç¨®é¡ž:"/>
          <TextBox Grid.Column="3" Classes="FormInput"
                   Text="{Binding NoticeType}"
                   Watermark="ä¾‹: Cå¯¾å¿œ, è¨­å‚™ç‚¹æ¤œ"/>

          <!-- å¯¾è±¡éƒ¨ç½² -->
          <TextBlock Grid.Column="4" Classes="FormLabel" Text="å¯¾è±¡éƒ¨ç½²:"/>
          <ComboBox Grid.Column="5" Classes="FormSelect"
              ItemsSource="{Binding Departments}"
              PlaceholderText="{Binding TargetDepartmentDisplay}"
              x:Name="TargetDepartmentComboBox">
            <i:Interaction.Behaviors>
              <core:EventTriggerBehavior EventName="SelectionChanged" SourceObject="{Binding #TargetDepartmentComboBox}">
                <core:InvokeCommandAction Command="{Binding OnDepartmentSelectionChangedCommand}"
                                          CommandParameter="{Binding #TargetDepartmentComboBox.SelectedItem}" />
                <core:ChangePropertyAction TargetObject="{Binding #TargetDepartmentComboBox}" PropertyName="SelectedItem" Value="{x:Null}" />
              </core:EventTriggerBehavior>
            </i:Interaction.Behaviors>

            <ComboBox.ItemTemplate>
              <DataTemplate x:DataType="vm:DepartmentViewModel">
                <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
              </DataTemplate>
            </ComboBox.ItemTemplate>
          </ComboBox>

          <!-- é€£çµ¡äº‹é …å†…å®¹ -->
          <TextBlock Grid.Column="6" Classes="FormLabel" Text="å†…å®¹:"/>
          <TextBox Grid.Column="7" Classes="FormInput"
                   Text="{Binding NoticeContent}"
                   Watermark="é€£çµ¡äº‹é …ã®è©³ç´°å†…å®¹"/>

          <!-- ç™»éŒ²/å¤‰æ›´ãƒœã‚¿ãƒ³ -->
          <Button Grid.Column="8"
                  Content="ç™»éŒ²"
                  Classes="PrimaryButton"
                  Command="{Binding RegisterNoticeCommand}"/>          
        </Grid>

        <!-- 2è¡Œç›®ï¼šé¸æŠžã•ã‚ŒãŸå¯¾è±¡éƒ¨ç½²ä¸€è¦§ï¼ˆå°ã•ã‚è¡¨ç¤ºï¼‰ -->
        <Grid Grid.Row="2"
              ColumnDefinitions="Auto,140,Auto,160,Auto,220,Auto,*,Auto"
              Margin="0,0,0,10">

          <StackPanel Grid.Column="1" Grid.ColumnSpan="7"
                      Orientation="Horizontal"
                      IsVisible="{Binding !IsAllDepartments}"
                      VerticalAlignment="Center">

            <TextBlock Text="é¸æŠžä¸­:" FontSize="11" Foreground="#666"
                       VerticalAlignment="Center" Margin="0,0,8,0"/>

            <ItemsControl ItemsSource="{Binding SelectedTargetDepartments}">
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="vm:TargetDepartmentViewModel">
                  <Border Background="#E3F2FD" BorderBrush="#2196F3" BorderThickness="1"
                          CornerRadius="3" Padding="6,2" Margin="0,0,4,2">
                    <StackPanel Orientation="Horizontal">
                      <TextBlock Text="{Binding Name}" VerticalAlignment="Center" FontSize="10"/>
                      <Button Content="Ã—" Background="Transparent" Foreground="#dc3545"
                              BorderThickness="0" Padding="2,0" Margin="4,0,0,0"
                              Command="{Binding RemoveTargetDepartmentCommand}" FontSize="9"/>
                    </StackPanel>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
              <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                  <WrapPanel/>
                </ItemsPanelTemplate>
              </ItemsControl.ItemsPanel>
            </ItemsControl>
          </StackPanel>

          <Button Grid.Column="8"
                  Content="ã‚¯ãƒªã‚¢"
                  Classes="ClearButton"
                  Command="{Binding ClearFormCommand}"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Top"/>
        </Grid>
      </Grid>
    </Border>

    <!-- å±¥æ­´ä¸€è¦§ -->
    <Border Grid.Row="2" Classes="DetailPanel" Margin="15,10,15,15">
      <Grid RowDefinitions="Auto,*">
        <Border Grid.Row="0" Classes="SectionHeader">
          <Grid ColumnDefinitions="*,Auto">
            <TextBlock Grid.Column="0" Text="ç™»éŒ²å±¥æ­´" FontWeight="Bold" FontSize="16" Foreground="#4682B4"/>
            <Button Grid.Column="1" Classes="ActionButton" Content="æœ€æ–°æƒ…å ±å–å¾—"
                    Command="{Binding RefreshDataCommand}"/>
          </Grid>
        </Border>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0,15,0,0">
          <ItemsControl ItemsSource="{Binding EmergencyNotices}">
            <ItemsControl.ItemTemplate>
              <DataTemplate x:DataType="vm:EmergencyNoticeItemViewModel">
                <Border Classes="HistoryListItem"
                        Classes.Active="{Binding IsActive}"
                        Classes.Inactive="{Binding !IsActive}"
                        >

                  <!-- ä¸€è¡Œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼šæ—¥æ™‚ã€é‡è¦åº¦ã€ç¨®é¡žã€å¯¾è±¡éƒ¨ç½²ã€å†…å®¹ã€ãƒœã‚¿ãƒ³é¡ž -->
                  <Grid ColumnDefinitions="120,80,120,300,*,Auto">

                    <!-- ä½œæˆæ—¥æ™‚ -->
                    <TextBlock Grid.Column="0" Text="{Binding CreatedAtDisplay}"
                               FontSize="12" FontWeight="SemiBold"
                               Margin="0,0,10,0" VerticalAlignment="Center"/>

                    <!-- é‡è¦åº¦ãƒãƒƒã‚¸ -->
                    <Border Grid.Column="1" Classes="StatusBadge" Background="{Binding PriorityColor}">
                      <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="{Binding PriorityIcon}" Foreground="White" FontSize="13" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding PriorityDisplay}" Foreground="White" FontSize="13"
                                   Margin="3,0,0,0" VerticalAlignment="Center"/>
                      </StackPanel>
                    </Border>

                    <!-- é€£çµ¡äº‹é …ç¨®é¡ž -->
                    <Border Grid.Column="2" Background="#F8F9FA" CornerRadius="4" Padding="8,4"
                            Margin="0,0,10,0" VerticalAlignment="Center">
                      <TextBlock Text="{Binding NoticeType}" FontSize="11" FontWeight="Bold"
                                 Foreground="#495057" VerticalAlignment="Center" TextAlignment="Center"/>
                    </Border>

                    <!-- å¯¾è±¡éƒ¨ç½² -->
                    <Border Grid.Column="3" Background="#E9ECEF" CornerRadius="4" Padding="8,4"
                            Margin="0,0,10,0" VerticalAlignment="Center">
                      <TextBlock Text="{Binding TargetDepartmentNames}" FontSize="11"
                                 Foreground="#6C757D" VerticalAlignment="Center" TextAlignment="Center"/>
                    </Border>

                    <!-- é€£çµ¡äº‹é …å†…å®¹ -->
                    <TextBlock Grid.Column="4" Text="{Binding NoticeContent}" FontSize="12"
                               TextWrapping="Wrap" VerticalAlignment="Center" Margin="0,0,10,0"/>

                    <!-- æœ‰åŠ¹ç„¡åŠ¹çŠ¶æ…‹ -->
                    <StackPanel Grid.Column="5" Orientation="Horizontal" VerticalAlignment="Center">
                      <Button Classes="ToggleButton" Content="{Binding InactiveButtonText}"
                              Background="{Binding InactiveButtonColor}"
                              Foreground="{Binding InactiveButtonTextColor}"
                              Command="{Binding $parent[Window].((vm:EmergencyNoticeViewModel)DataContext).ToggleNoticeCommand}"
                              CommandParameter="{Binding}"/>
                      <Button Classes="ActionButton" Content="ã‚³ãƒ”ãƒ¼"
                              Command="{Binding $parent[Window].((vm:EmergencyNoticeViewModel)DataContext).CopyToFormCommand}"
                              CommandParameter="{Binding}"
                              ToolTip.Tip="ãƒ•ã‚©ãƒ¼ãƒ ã«ã‚³ãƒ”ãƒ¼"/>
                    </StackPanel>
                  </Grid>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </ScrollViewer>

        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
        <TextBlock Grid.Row="1" Text="èª­ã¿è¾¼ã¿ä¸­..." HorizontalAlignment="Center"
                   VerticalAlignment="Center" IsVisible="{Binding IsLoading}"/>

        <!-- ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã®è¡¨ç¤º -->
        <StackPanel Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Center"
                    IsVisible="{Binding IsEmptyList}">
          <TextBlock Text="ðŸ“‹" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,10"/>
          <TextBlock Text="ã¾ã ç·Šæ€¥é€£çµ¡äº‹é …ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“" FontSize="16"
                     Foreground="#666666" HorizontalAlignment="Center"/>
        </StackPanel>
      </Grid>
    </Border>
  </Grid>
</Window>
