<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:i="using:Avalonia.Xaml.Interactivity"
             xmlns:behaviors="using:Avalonia.Xaml.Interactions.Core"
             xmlns:vm="clr-namespace:MessageManager.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="MessageManager.Views.MessageListView"
             x:DataType="vm:MessageListViewModel">
  <Grid ColumnDefinitions="200,*">

    <Border Grid.Column="0" Background="White" BorderBrush="#DDDDDD" BorderThickness="1"
            CornerRadius="4" Padding="15" Margin="0,0,5,0">
      <StackPanel>
        <Border Background="#4682B4" CornerRadius="3" Padding="8,4" Margin="0,0,0,15">
          <TextBlock Text="メニュー" FontWeight="Bold" FontSize="16" Foreground="White" HorizontalAlignment="Center"/>
        </Border>

        <Button HorizontalAlignment="Stretch" Margin="0,0,0,5" Padding="15,10"
                Command="{Binding SelectReceivedMessagesCommand}"
                Classes.selected="{Binding IsReceivedMessagesSelected}">
          <Button.Styles>
            <Style Selector="Button">
              <Setter Property="Background" Value="#f8f9fa"/>
              <Setter Property="Foreground" Value="#495057"/>
              <Setter Property="BorderBrush" Value="#dee2e6"/>
              <Setter Property="BorderThickness" Value="1"/>
              <Setter Property="CornerRadius" Value="4"/>
            </Style>
            <Style Selector="Button:pointerover">
              <Setter Property="Background" Value="#e9ecef"/>
            </Style>
            <Style Selector="Button.selected">
              <Setter Property="Background" Value="#D4EAF7"/>
              <Setter Property="Foreground" Value="Black"/>
              <Setter Property="BorderBrush" Value="#007BFF"/>
            </Style>
          </Button.Styles>
          <TextBlock Text="受信メッセージ" FontSize="14" FontWeight="Bold"/>
        </Button>

        <Button HorizontalAlignment="Stretch" Padding="15,10"
                Command="{Binding SelectSentMessagesCommand}"
                Classes.selected="{Binding IsSentMessagesSelected}">
          <Button.Styles>
            <Style Selector="Button">
              <Setter Property="Background" Value="#f8f9fa"/>
              <Setter Property="Foreground" Value="#495057"/>
              <Setter Property="BorderBrush" Value="#dee2e6"/>
              <Setter Property="BorderThickness" Value="1"/>
              <Setter Property="CornerRadius" Value="4"/>
            </Style>
            <Style Selector="Button:pointerover">
              <Setter Property="Background" Value="#e9ecef"/>
            </Style>
            <Style Selector="Button.selected">
              <Setter Property="Background" Value="#D4EAF7"/>
              <Setter Property="Foreground" Value="Black"/>
              <Setter Property="BorderBrush" Value="#007BFF"/>
            </Style>
          </Button.Styles>
          <TextBlock Text="送信メッセージ" FontSize="14" FontWeight="Bold"/>
        </Button>
      </StackPanel>
    </Border>

    <Border Grid.Column="1" Background="White" BorderBrush="#DDDDDD" BorderThickness="1"
            CornerRadius="4" Padding="15" Margin="5,0">
      <Grid RowDefinitions="Auto,*,Auto">
        <Border Grid.Row="0" Background="#4682B4" CornerRadius="3" Padding="8,4" HorizontalAlignment="Stretch" Margin="0,0,0,10">
          <TextBlock Text="{Binding SelectedMessagesTitle}" FontWeight="Bold" FontSize="16" Foreground="White"/>
        </Border>
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
          <StackPanel>
            <ItemsControl ItemsSource="{Binding ReceivedMessages}" IsVisible="{Binding IsReceivedMessagesSelected}">
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="vm:MessageListItemViewModel">
                  <Border CornerRadius="4" Padding="8,6" Margin="0,0,0,4" Cursor="Hand" MinHeight="32" Classes.selected="{Binding IsSelected}">
                    <Border.Styles>
                      <Style Selector="Border">
                        <Setter Property="Background" Value="White"/>
                        <Setter Property="BorderBrush" Value="#DDDDDD"/>
                        <Setter Property="BorderThickness" Value="1"/>
                      </Style>
                      <Style Selector="Border:pointerover">
                        <Setter Property="Background" Value="#F0F8FF"/>
                        <Setter Property="BorderBrush" Value="#4682B4"/>
                      </Style>
                      <Style Selector="Border.selected">
                        <Setter Property="Background" Value="#D4EAF7"/>
                        <Setter Property="BorderBrush" Value="#007BFF"/>
                      </Style>
                    </Border.Styles>
                    <i:Interaction.Behaviors>
                      <behaviors:EventTriggerBehavior EventName="Tapped">
                        <behaviors:InvokeCommandAction Command="{Binding SelectItemCommand}" />
                      </behaviors:EventTriggerBehavior>
                    </i:Interaction.Behaviors>
                    <Grid ColumnDefinitions="Auto,Auto,*,Auto,Auto,Auto">
                      <TextBlock Grid.Column="0" Text="★" FontSize="12" Foreground="#2196F3" Margin="4,0,8,0" IsVisible="{Binding IsSelected}"/>
                      <TextBlock Grid.Column="1" Text="{Binding PriorityIcon}" FontSize="14" Margin="0,0,8,0" VerticalAlignment="Center"/>
                      <StackPanel Grid.Column="2" VerticalAlignment="Center">
                        <TextBlock Text="{Binding Subject}" FontWeight="Bold" FontSize="12" TextTrimming="CharacterEllipsis"/>
                        <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                          <TextBlock Text="送信元:" FontSize="11" Foreground="#666666" VerticalAlignment="Center" Margin="0,0,4,0"/>
                          <TextBlock Text="{Binding FromDeptName}" FontSize="11" VerticalAlignment="Center" Margin="0,0,8,0"/>
                          <TextBlock Text="{Binding DateDisplay}" FontSize="11" Foreground="#666666" VerticalAlignment="Center"/>
                        </StackPanel>
                      </StackPanel>
                      <Border Grid.Column="3" CornerRadius="8" Padding="4,1" Margin="4,0" Background="{Binding StatusColor}" MaxHeight="18" IsVisible="{Binding HasDueDate}">
                        <TextBlock Text="{Binding DueDateDisplay}" Foreground="White" FontSize="9"/>
                      </Border>
                      <Border Grid.Column="4" CornerRadius="8" Padding="4,1" Margin="4,0" Background="{Binding ActionStatusColor}" MaxHeight="18" IsVisible="{Binding RequiresAction}">
                        <TextBlock Text="{Binding ActionStatusDisplay}" Foreground="White" FontSize="9"/>
                      </Border>
                      <TextBlock Grid.Column="5" Text="{Binding StatusDisplay}" FontSize="11" Foreground="{Binding StatusColor}" Margin="8,0,0,0" VerticalAlignment="Center"/>
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>

            <ItemsControl ItemsSource="{Binding SentMessages}" IsVisible="{Binding IsSentMessagesSelected}">
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="vm:SentMessageListItemViewModel">
                  <Border CornerRadius="4" Padding="8,6" Margin="0,0,0,4" Cursor="Hand" MinHeight="32" Classes.selected="{Binding IsSelected}">
                    <Border.Styles>
                      <Style Selector="Border">
                        <Setter Property="Background" Value="White"/>
                        <Setter Property="BorderBrush" Value="#DDDDDD"/>
                        <Setter Property="BorderThickness" Value="1"/>
                      </Style>
                      <Style Selector="Border:pointerover">
                        <Setter Property="Background" Value="#F0F8FF"/>
                        <Setter Property="BorderBrush" Value="#4682B4"/>
                      </Style>
                      <Style Selector="Border.selected">
                        <Setter Property="Background" Value="#D4EAF7"/>
                        <Setter Property="BorderBrush" Value="#007BFF"/>
                      </Style>
                    </Border.Styles>
                    <i:Interaction.Behaviors>
                      <behaviors:EventTriggerBehavior EventName="Tapped">
                        <behaviors:InvokeCommandAction Command="{Binding SelectItemCommand}" />
                      </behaviors:EventTriggerBehavior>
                    </i:Interaction.Behaviors>
                    <Grid ColumnDefinitions="Auto,Auto,*,Auto,Auto">
                      <TextBlock Grid.Column="0" Text="★" FontSize="12" Foreground="#2196F3" Margin="4,0,8,0" IsVisible="{Binding IsSelected}"/>
                      <TextBlock Grid.Column="1" Text="{Binding PriorityIcon}" FontSize="14" Margin="0,0,8,0" VerticalAlignment="Center"/>
                      <StackPanel Grid.Column="2" VerticalAlignment="Center">
                        <TextBlock Text="{Binding Subject}" FontWeight="Bold" FontSize="12" TextTrimming="CharacterEllipsis"/>
                        <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                          <TextBlock Text="送信先:" FontSize="11" Foreground="#666666" VerticalAlignment="Center" Margin="0,0,4,0"/>
                          <TextBlock Text="{Binding ToDeptNames}" FontSize="11" VerticalAlignment="Center" Margin="0,0,8,0" TextTrimming="CharacterEllipsis"/>
                          <TextBlock Text="{Binding DateDisplay}" FontSize="11" Foreground="#666666" VerticalAlignment="Center"/>
                        </StackPanel>
                      </StackPanel>
                      <Border Grid.Column="3" CornerRadius="8" Padding="4,1" Margin="4,0" Background="#FFA000" MaxHeight="18" IsVisible="{Binding HasDueDate}">
                        <TextBlock Text="{Binding DueDateDisplay}" Foreground="White" FontSize="9"/>
                      </Border>
                      <TextBlock Grid.Column="4" Text="[対応要求]" FontSize="10" Foreground="#666666" Margin="8,0,0,0" VerticalAlignment="Center" IsVisible="{Binding RequiresAction}"/>
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </StackPanel>
        </ScrollViewer>
      </Grid>
    </Border>
  </Grid>
</UserControl>
